# أوامر تشغيل وإدارة منصة التداول

## أوامر تشغيل التطبيق الرئيسية

| الأمر                                      | الوصف                         | التفاصيل                                                                  |
| ------------------------------------------ | ----------------------------- | ------------------------------------------------------------------------- |
| `npm run dev`                              | تشغيل التطبيق في وضع التطوير  | يشغل `tsx server/index.ts` ويتيح إعادة التحميل التلقائي عند تغيير الملفات |
| `npm run start`                            | تشغيل التطبيق في وضع الإنتاج  | يشغل `NODE_ENV=production tsx server/index.ts`                            |
| `npm run build`                            | بناء التطبيق للإنتاج          | يجمع ويحسن الكود للنشر                                                    |
| `cd server && npm run start`               | تشغيل الخادم فقط              | يشغل `npx ts-node-esm index.ts`                                           |
| `bash scripts/start/start-all-services.sh` | تشغيل جميع الخدمات دفعة واحدة | يشغل الخادم الرئيسي وخدمات الذكاء الاصطناعي                               |

## أوامر إدارة خدمات الذكاء الاصطناعي

| الأمر                                    | الوصف                                     | التفاصيل                                         |
| ---------------------------------------- | ----------------------------------------- | ------------------------------------------------ |
| `npm run ai:start`                       | بدء خادم الذكاء الاصطناعي                 | يشغل نموذج الذكاء الاصطناعي الأساسي              |
| `npm run ai:restart`                     | إعادة تشغيل خادم الذكاء الاصطناعي         | يوقف ثم يعيد تشغيل خدمة الذكاء الاصطناعي         |
| `npm run ai:arabic:start`                | بدء نموذج الذكاء الاصطناعي باللغة العربية | يشغل نموذج AI المخصص للغة العربية                |
| `npm run ai:arabic:restart`              | إعادة تشغيل نموذج الذكاء الاصطناعي العربي | يوقف ثم يعيد تشغيل نموذج الذكاء الاصطناعي العربي |
| `bash scripts/start/start-ai-service.sh` | تشغيل خدمة الذكاء الاصطناعي الأساسية      | يعمل مباشرة من خلال سطر الأوامر                  |
| `bash scripts/start/start-mock-ai.sh`    | تشغيل خدمة محاكاة الذكاء الاصطناعي        | يشغل نموذج محاكاة للتطوير والاختبار              |
| `bash scripts/start/start-arabic-ai.sh`  | تشغيل نموذج اللغة العربية                 | يشغل خدمة معالجة اللغة العربية                   |

## أوامر إدارة قاعدة البيانات

| الأمر                             | الوصف                            | التفاصيل                                       |
| --------------------------------- | -------------------------------- | ---------------------------------------------- |
| `npm run db:migrate`              | تنفيذ ترحيلات قاعدة البيانات     | يطبق جميع الترحيلات المعلقة على قاعدة البيانات |
| `npm run db:performance-test`     | اختبار أداء قاعدة البيانات       | يقيس أداء الاستعلامات وتحسينات الفهارس         |
| `npm run db:setup`                | إعداد قاعدة البيانات             | ينشئ الجداول ويضيف البيانات الأولية            |
| `npm run db:verify-optimizations` | التحقق من تحسينات قاعدة البيانات | يتأكد من تطبيق جميع تحسينات الأداء             |
| `node server/apply-migration.js`  | تطبيق ترحيل محدد                 | تنفيذ ملف ترحيل معين يدويًا                    |
| `node server/seed.ts`             | زرع البيانات الأولية             | إضافة بيانات افتراضية لقاعدة البيانات          |

## أوامر إدارة بيانات السوق

| الأمر                                  | الوصف                           | التفاصيل                                       |
| -------------------------------------- | ------------------------------- | ---------------------------------------------- |
| `npm run market:update`                | تحديث بيانات السوق              | تنفيذ تحديث فوري لبيانات الأسعار والأصول       |
| `npm run market:update:cron`           | تحديث دوري لبيانات السوق        | يعد جدولة للتحديثات التلقائية بناءً على Cron   |
| `node scripts/update-market-data.js`   | تشغيل تحديث بيانات السوق مباشرة | تنفيذ مباشر لتحديث بيانات السوق من Polygon API |
| `node server/crypto-price-updater.mjs` | تحديث أسعار العملات المشفرة     | تحديث مخصص لأسعار العملات المشفرة فقط          |

## أوامر أدوات التطوير

| الأمر                                             | الوصف                        | التفاصيل                              |
| ------------------------------------------------- | ---------------------------- | ------------------------------------- |
| `node client/scripts/refactor-codebase.js`        | تنفيذ إعادة هيكلة الكود      | يقوم بإصلاحات وتحسينات شاملة للكود    |
| `node client/scripts/add-validation.js`           | إضافة التحقق من صحة البيانات | يضيف تحققًا من صحة البيانات للمكونات  |
| `node client/scripts/find-duplicates.js`          | البحث عن التكرارات           | يحدد المكونات والوظائف المكررة        |
| `node client/scripts/identify-websocket-usage.js` | تحديد استخدام WebSocket      | يكتشف استخدامات WebSocket في الكود    |
| `node client/scripts/identify-type-issues.js`     | تحديد مشاكل الأنواع          | يكتشف مشاكل TypeScript ويقترح إصلاحات |
| `node client/scripts/update-imports.js`           | تحديث الاستيرادات            | تحديث مسارات وصيغ الاستيراد           |

## سير عمل تشغيل التطبيق الكامل

لتشغيل التطبيق بكامل خدماته، يمكن اتباع التسلسل التالي:

1. **تحضير قاعدة البيانات**:

   ```bash
   npm run db:migrate
   npm run db:verify-optimizations
   ```

2. **تشغيل جميع الخدمات بأمر واحد**:

   ```bash
   bash scripts/start/start-all-services.sh
   ```

   أو تشغيل الخدمات منفصلة:

3. **تشغيل خادم الويب**:

   ```bash
   cd server && npm run start
   ```

4. **تشغيل خدمة الذكاء الاصطناعي**:

   ```bash
   bash scripts/start/start-ai-service.sh
   ```

5. **تشغيل نموذج اللغة العربية** (اختياري):

   ```bash
   bash scripts/start/start-arabic-ai.sh
   ```

6. **بدء تحديث بيانات السوق**:
   ```bash
   node scripts/update-market-data.js
   ```

## ملاحظات هامة

1. **ترتيب التشغيل**: من المستحسن بدء تشغيل قاعدة البيانات والخادم قبل خدمات الذكاء الاصطناعي وتحديث بيانات السوق.

2. **وضع التطوير مقابل الإنتاج**: في وضع التطوير (`npm run dev`)، يتم تفعيل إعادة التحميل التلقائي وتفصيل الأخطاء، بينما في وضع الإنتاج (`npm run start`) يتم تحسين الأداء وتقليل المعلومات التشخيصية.

3. **خدمات الذكاء الاصطناعي**: يمكن تشغيل خدمات الذكاء الاصطناعي بشكل مستقل أو كجزء من حزمة الخدمات الكاملة.

4. **تحديثات بيانات السوق**: يمكن تشغيل تحديثات بيانات السوق يدويًا أو إعدادها لتعمل تلقائيًا باستخدام Cron.

5. **إعادة هيكلة الكود**: أدوات إعادة الهيكلة متاحة في مجلد `client/scripts/` ويمكن تنفيذها بشكل منفصل أو معًا من خلال أمر `refactor-codebase.js`.
